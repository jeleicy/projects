<?php namespace App\Http\Controllers;

use App\Http\Controllers\FuncionesControllers;
use Session;
use DB;
use Form;

?>

<?php echo $__env->make('layaout.header_admin', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<table width="62%" border="0" cellspacing="2" cellpadding="10" class="tablas_int" align="center">
<tr>
	<td>
<?php echo Form::open(array('url' => 'listado_observadores', 'method' => 'get')); ?>

<strong>Buscar por Cedula:</strong><input class="input_peq" type="text" name="cedula" onkeypress="return numeros(event)" value="<?= $cedula; ?>">
<br />	
<strong>Buscar por estatus: </strong>
<ul>
	<li><input class="chk" type="radio" name="estatus_busqueda" value="0" <?php if ($estatus_busqueda==0) echo "checked"; ?>>TODOS</li>
	<li><input class="chk" type="radio" name="estatus_busqueda" value="1" <?php if ($estatus_busqueda==1) echo "checked"; ?>>Llamada no realizada</li>
	<li><input class="chk" type="radio" name="estatus_busqueda" value="2" <?php if ($estatus_busqueda==2) echo "checked"; ?>>Reporte Procesado Satisfactoriamente</li>
	<li><input class="chk" type="radio" name="estatus_busqueda" value="3" <?php if ($estatus_busqueda==3) echo "checked"; ?>>Reporte en Recuperacion 1</li>
	<li><input class="chk" type="radio" name="estatus_busqueda" value="4" <?php if ($estatus_busqueda==4) echo "checked"; ?>>Reporte en Recuperacion 2</li>
</ul>
<input class="btn" type="submit" id="buscar" name="Buscar" value="Buscar" />
<?php echo Form::close(); ?>

<br /><br />
<div align="center">
<strong>Leyenda:</strong>
<img src="images/nollamada.gif" width="45" height="35" border=0 />Llamada no realizada / 
<img src="images/planllena.gif" width="45" height="35" border=0 />Procesado Satisfactoriamente / 
<img src="images/recup1.gif" width="45" height="35" border=0 />Recuperacion 1 / 
<img src="images/recup2.gif" width="45" height="35" border=0 />Recuperacion 2
</div>
<br /><br />
</td>
</tr>
<tr>
<td>
<table width="100%" border="0" cellspacing="2" cellpadding="10" class="tablas_int" align="center">
  <tr class="fondo3">
	<td>&nbsp;</td>
	<td>C&eacute;dula</td>
	<td>Nombre</td>	
	<td>Tlf Cel</td>
	<td>Tlf Hab</td>
	<td>Tlf Otro</td>
	<td>Email</td>
	<td>Estatus</td>
  </tr>
  <?php	
		$sql = "select distinct(o.id_observador), o.*, a.id_asignacion ";
		$sql .= "from observador o, asignacion a, asignacion_operador ao, estatus e ";
		$sql .= "where a.id_observador=o.id_observador and ";
		$sql .= "ao.id_observador=o.id_observador and  ";			
		$sql .= "ao.id_observador=o.id_observador and ";
		$sql .= "e.id_operador=ao.id_operador and ";
		$sql .= "e.id_asignacion=a.id_asignacion";
		if (SessionusuarioControllers::show("id_observador")>1)
			$sql .= " and ao.id_operador=".SessionusuarioControllers::show("id_observador");
		if ($cedula!=0 && $cedula!="")
			$sql .= " and o.cedula=$cedula ";
		if ($estatus_busqueda>0) {
			if ($estatus_busqueda==1)
				$sql .= " and (e.r1_estatus='' or e.r2_estatus='' or e.r3_estatus='' or e.r4_estatus='')";
			elseif ($estatus_busqueda==2)
				$sql .= " and (e.r1_estatus='P' or e.r2_estatus='P' or e.r3_estatus='P' or e.r4_estatus='P')";
			elseif ($estatus_busqueda==3)
				$sql .= " and (e.r1_estatus='RC1' or e.r2_estatus='RC1' or e.r3_estatus='RC1' or e.r4_estatus='RC1')";
			elseif ($estatus_busqueda==4)
				$sql .= " and (e.r1_estatus='RC2' or e.r2_estatus='RC2' or e.r3_estatus='RC2' or e.r4_estatus='RC2')";
		}
		$sql .= " order by o.apellidos, o.nombres";
		// echo $sql;

		$data=DB::select($sql);
		$i=1;
		$j=1;
		foreach ($data as $data) {
			if ($i==1) $i=2;
			else $i=1;
			
			$nac = $data->nac;
			$cedula = $data->cedula;
			$nombres = $data->nombres;
			$apellidos = $data->apellidos;
			$email = $data->email;
			$id_observador = $data->id_observador;
			$tlfcel = $data->tlfcel;
			$tlfhab = $data->tlfhab;
			$tlfotro = $data->tlfotro;
			$autorizado = $data->autorizado;
			$privilegio = $data->privilegio;
			$fecha_ing = $data->fecha_ing;
			//$centro = $data->centro;
			$codigo = $data->codigo;
			$id_asignacion = $data->id_asignacion;
			
			$estatus=FuncionesControllers::buscar_estatus($id_asignacion);
		?>
		  <tr class="fondo<?php echo $i; ?>" >
			<td align="center"><strong><?php echo $j; ?></strong></td>
			<td><?php echo $nac."-".$cedula; ?></td>
			<td><?php echo $apellidos." ".$nombres;; ?></td>
			<td><?php echo $tlfcel; ?></td>
			<td><?php echo $tlfhab; ?></td>
			<td><?php echo $tlfotro; ?></td>
			<td><?php echo $email; ?></td>
			<td>
				<?php
					$r1=substr($estatus,0,strpos($estatus,"/"));
					$estatus=substr($estatus,strpos($estatus,"/")+1);
					$r2=substr($estatus,0,strpos($estatus,"/"));
					$estatus=substr($estatus,strpos($estatus,"/")+1);
					$r3=substr($estatus,0,strpos($estatus,"/"));
					$estatus=substr($estatus,strpos($estatus,"/")+1);
					$r4=$estatus;
					
					if ($r1=="") $imagen1="r1_nollamada";
					elseif ($r1=="P") $imagen1="r1_planllena";
					elseif ($r1=="RC1") $imagen1="r1_recup1";
					elseif ($r1=="RC2") $imagen1="r1_recup2";					
					
					if ($r2=="") $imagen2="r2_nollamada";
					elseif ($r2=="P") $imagen2="r2_planllena";
					elseif ($r2=="RC1") $imagen2="r2_recup1";
					elseif ($r2=="RC2") $imagen2="r2_recup2";					
					
					if ($r3=="") $imagen3="r3_nollamada";
					elseif ($r3=="P") $imagen3="r3_planllena";
					elseif ($r3=="RC1") $imagen3="r3_recup1";
					elseif ($r3=="RC2") $imagen3="r3_recup2";					
					
					if ($r4=="") $imagen4="r4_nollamada";
					elseif ($r4=="P") $imagen4="r4_planllena";
					elseif ($r4=="RC1") $imagen4="r4_recup1";
					elseif ($r4=="RC2") $imagen4="r4_recup2";
				?>
				<a href="?mod=reportes_planillas&numero=1&id_observador=<?php echo $id_observador; ?>&numero=1"><img src="images/<?php echo $imagen1; ?>.gif" width="45" height="35" border=0></a>
				<a href="?mod=reportes_planillas&numero=1&id_observador=<?php echo $id_observador; ?>&numero=2"><img src="images/<?php echo $imagen2; ?>.gif" width="45" height="35" border=0></a>
				<a href="?mod=reportes_planillas&numero=1&id_observador=<?php echo $id_observador; ?>&numero=3"><img src="images/<?php echo $imagen3; ?>.gif" width="45" height="35" border=0></a>
				<a href="?mod=reportes_planillas&numero=1&id_observador=<?php echo $id_observador; ?>&numero=4"><img src="images/<?php echo $imagen4; ?>.gif" width="45" height="35" border=0></a>
			</td>
		  </tr>		
		<?php
			$j++;
		}
  ?>
</table>
</td>
</tr>
</table>
<br />
<div align="center">
	<input class="btn" type="button" name="Imprimir" value="Imprimir Listado" onclick="imprimir_listado_operador(<?php echo e(SessionusuarioControllers::show("id_observador")); ?>)" />
	<input class="btn" type="button" name="Regresar" value="Regresar" onclick="history.back();" />
</div>

<?php echo $__env->make('layaout.footer_admin', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>